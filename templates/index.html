{% extends "template.html" %}
{% block content %}
<title>Editor2777</title>
<!-- Form ================================================== -->
<div class="form">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <p class="lead">
          {% if name %}
            Hello {{ name }} san
          {% else %}
            {{ message }}
          {% endif %}
        </p>
        <form action="/post" method="post" class="form-inline">
          <label for="name">Name</label>
          <input type="text" class="form-control" id="name" name="name" placeholder="Name">
          <button type="submit" class="btn btn-default">Submit</button>
        </form>
      </div>
    </div>
  </div>
</div>
<h2>Users Table</h2>
<div class="btn-group" role="group">
  <button id="#add-user" type="button" class="btn btn-primary">Add</button>
  <button id="#del-user" type="button" class="btn btn-primary">Del</button>
</div>
<div id="user-table"></div>
<hr>
<h2>Spec Table</h2>
<div class="btn-group" role="group">
  <button id="#add-spec" type="button" class="btn btn-primary">Add</button>
  <button id="#del-spec" type="button" class="btn btn-primary">Del</button>
</div>
<div id="spec-table"></div>
<script>
  //define some sample data
  var usersdata = {{users|tojson}};
  var specdata  = {{specs|tojson}};
  var usertable = new Tabulator("#user-table", {
    height:400,
    data:usersdata, 
    layout:"fitColumns", 
    columns:[
      {title:"ID", field:"id", width:100},
      {title:"Name", field:"name", editor:"input"},
    ],
  });
  function addData(modelname, newdata, table) {
    let ajax_data = {};
    if (newdata == null) {
      ajax_data = {model: mmodelname, name:"newdata"};
    } else {
      ajax_data = Object.assign({model: modelname}, newdata);
    }
    $.ajax({
      url: "update-data",
      type: "POST",
      dataType: "json",
      data: ajax_data,
      //timeout: 5000,
    })
    .done(function(data){
      let new_id = data["new_id"];
      if (newdata == null) {
        table.addData([data]);
      } else {
        table.updateData([data]);
      }
      alert("Success");
    })
    .fail(function(){
      alert("Failed");
    })
  }
  $("#add-user").clicked({function(){
    addData("User");
  });
  var usertable = new Tabulator("#spec-table", {
    height:400,
    data:specdata, 
    layout:"fitColumns", 
    columns:[ 
      {title:"ID", field:"guid", width:100},
      {title:"Name", field:"name", editor:"input", width:200},
      {title:"Definition", field:"definition", editor:"textarea"},
      {title:"Updated", field:"updated"},
    ],
  });
</script>
{% endblock %}
